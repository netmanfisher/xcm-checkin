# 小虾米每日打卡系统 - 详细开发文档 v2.0

## 📋 项目概述

### 项目名称
小虾米每日打卡系统

### 项目目标
为一年级学生设计的一款趣味化每日打卡应用，支持多个孩子独立使用，通过游戏化机制激发学习兴趣，培养良好习惯。

### 核心功能
1. 每日任务打卡（需管理员审核）
2. 星币⭐️积分奖励系统
3. 荣誉墙与成就系统
4. 愿望清单兑换
5. 学习计划管理
6. 管理员后台（多孩子管理）
7. 月度报告生成（图表分析）
8. 离线支持
9. 主题切换（公主/王子）

---

## 🏗️ 系统架构

### 技术栈
```
前端：Vue 3 + Vite
UI框架：自定义组件
状态管理：Pinia
数据存储：
  - LocalStorage（本地离线缓存）
  - Supabase（云端数据库）
部署：
  - Vercel（前端托管）
  - Supabase（后端API + 数据库）
```

### 数据库设计（Supabase）

**命名规范：所有表名必须以项目名称前缀，格式：`xcm_表名`**

```sql
-- 1. 用户/孩子表
xcm_children
├── id (UUID, PK)
├── name (VARCHAR) - 孩子昵称
├── avatar_url (VARCHAR) - 头像
├── theme (VARCHAR) - 主题类型 'princess' | 'prince'
├── level (INTEGER) - 等级
├── stars (INTEGER) - 当前星星数
├── total_earned (INTEGER) - 累计获得
├── total_spent (INTEGER) - 累计消费
├── birth_date (DATE) - 生日
├── status (VARCHAR) - 状态 'active' | 'inactive'
├── created_at (TIMESTAMP)
└── updated_at (TIMESTAMP)

-- 2. 学习计划表
xcm_study_plans
├── id (UUID, PK)
├── name (VARCHAR) - 计划名称
├── icon (VARCHAR) - emoji图标
├── description (VARCHAR) - 描述
├── frequency (VARCHAR) - 频率 'daily' | 'weekdays' | 'custom'
├── custom_days (ARRAY) - 自定义天数 ["1","2","3","4","5","6","0"]
├── duration_minutes (INTEGER) - 建议时长
├── stars_reward (INTEGER) - 奖励星星
├── require_photo (BOOLEAN) - 是否需要照片
├── require_audio (BOOLEAN) - 是否需要音频
├── status (VARCHAR) - 'active' | 'paused' | 'archived'
├── sort_order (INTEGER) - 排序
├── created_by (UUID) - 创建人（管理员）
├── created_at (TIMESTAMP)
└── updated_at (TIMESTAMP)

-- 3. 打卡记录表
xcm_check_ins
├── id (UUID, PK)
├── child_id (UUID, FK) - 孩子ID
├── plan_id (UUID, FK) - 计划ID
├── plan_name (VARCHAR) - 计划名称（冗余）
├── check_in_time (TIMESTAMP) - 打卡时间
├── duration_minutes (INTEGER) - 实际用时
├── notes (TEXT) - 备注
├── photo_url (VARCHAR) - 照片URL
├── audio_url (VARCHAR) - 音频URL
├── status (VARCHAR) - 'pending' | 'approved' | 'rejected'
├── review_note (TEXT) - 审核备注
├── reviewed_by (UUID) - 审核人
├── reviewed_at (TIMESTAMP) - 审核时间
├── created_at (TIMESTAMP)
└── updated_at (TIMESTAMP)

-- 4. 积分历史表
xcm_stars_history
├── id (UUID, PK)
├── child_id (UUID, FK) - 孩子ID
├── type (VARCHAR) - 'earn' | 'spend'
├── amount (INTEGER) - 数量（正负）
├── description (VARCHAR) - 描述
├── related_id (UUID) - 关联ID（打卡或愿望）
├── related_type (VARCHAR) - 'check_in' | 'wish'
├── transaction_at (TIMESTAMP) - 交易时间
└── created_at (TIMESTAMP)

-- 5. 愿望清单表
xcm_wishes
├── id (UUID, PK)
├── name (VARCHAR) - 愿望名称
├── icon (VARCHAR) - emoji图标
├── description (VARCHAR) - 描述
├── stars_cost (INTEGER) - 所需星星
├── status (VARCHAR) - 'available' | 'inactive'
├── sort_order (INTEGER) - 排序
├── created_by (UUID) - 创建人
├── created_at (TIMESTAMP)
└── updated_at (TIMESTAMP)

-- 6. 兑换记录表
xcm_redemptions
├── id (UUID, PK)
├── child_id (UUID, FK) - 孩子ID
├── wish_id (UUID, FK) - 愿望ID
├── wish_name (VARCHAR) - 愿望名称（冗余）
├── stars_cost (INTEGER) - 消费星星
├── redeemed_at (TIMESTAMP) - 兑换时间
└── created_at (TIMESTAMP)

-- 7. 成就表
xcm_achievements
├── id (UUID, PK)
├── name (VARCHAR) - 成就名称
├── description (VARCHAR) - 描述
├── icon (VARCHAR) - emoji图标
├── requirement_type (VARCHAR) - 类型
├── requirement_value (INTEGER) - 要求值
├── stars_reward (INTEGER) - 奖励星星
└── created_at (TIMESTAMP)

-- 8. 用户成就关联表
xcm_user_achievements
├── id (UUID, PK)
├── child_id (UUID, FK) - 孩子ID
├── achievement_id (UUID, FK) - 成就ID
├── unlocked_at (TIMESTAMP) - 解锁时间
└── created_at (TIMESTAMP)

-- 9. 连续打卡表
xcm_streaks
├── id (UUID, PK)
├── child_id (UUID, FK) - 孩子ID
├── current_streak (INTEGER) - 当前连续天数
├── longest_streak (INTEGER) - 最长连续天数
├── last_check_in_date (DATE) - 最后打卡日期
└── updated_at (TIMESTAMP)

-- 10. 管理员表
xcm_admins
├── id (UUID, PK)
├── username (VARCHAR) - 用户名
├── password_hash (VARCHAR) - 密码哈希
├── email (VARCHAR) - 邮箱
├── permissions (ARRAY) - 权限列表
├── created_at (TIMESTAMP)
└── updated_at (TIMESTAMP)
```

---

## 📱 页面结构与功能

### 0. 孩子选择页（登录）

#### 功能描述
- 显示所有已添加的孩子
- 点击选择当前使用的孩子
- 输入PIN码或图案解锁（可选）

#### 界面元素
```
┌─────────────────────────────────────┐
│     小虾米每日打卡                   │
│                                     │
│  请选择你的头像                     │
│                                     │
│  ┌─────────┐  ┌─────────┐         │
│  │  👧    │  │  👦    │         │
│  │ 小虾米  │  │ 小小明  │         │
│  │         │  │         │         │
│  └─────────┘  └─────────┘         │
│                                     │
│  ┌─────────┐  ┌─────────┐         │
│  │  👧    │  │  👦    │         │
│  │ 小花    │  │ 小强    │         │
│  │         │  │         │         │
│  └─────────┘  └─────────┘         │
│                                     │
│        [+] 添加新孩子               │
│                                     │
│        [🔧 管理员登录]              │
└─────────────────────────────────────┘
```

---

### 1. 主页（首页）

#### 功能描述
- 显示选中孩子的信息
- 周历视图（显示一周7天的打卡状态）
- 今日任务列表（横向滚动卡片）
- 快速打卡功能

#### 界面元素
```
┌─────────────────────────────────────┐
│  👋 小虾米              [头像] [设置]│
│  2025年1月19日 星期日               │
│  ⭐ 1,250        🔥 连续7天         │
│                                     │
│  📊 本周进度                        │
│  ┌───┬───┬───┬───┬───┬───┬───┐    │
│  │13 │14 │15 │16 │17 │18 │19 │    │
│  │一 │二 │三 │四 │五 │六 │日 │    │
│  │ ✅│ ✅│ 3 │ ✅│ 5 │ ✅│ 2 │    │
│  └───┴───┴───┴───┴───┴───┴───┘    │
│                                     │
│  今日任务 (横向滚动)                 │
│  ┌───────────────────────────────┐ │
│  │  🎹  钢琴练习    [⏱30] [✅]   │ │
│  │  19:30 已完成                 │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │  📝  家庭作业    [⏱30] [📸]  │ │
│  │         [开始打卡]            │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │  ✍️  写字练习   [⏱20] [📸]  │ │
│  │         [开始打卡]            │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 任务卡片样式说明
- 参考图片 1.jpg 的布局
- 横向长条形卡片
- 左侧：图标 + 名称
- 中间：时长 + 要求（照片/音频）
- 右侧：状态/按钮

#### 周历状态说明
- ✅ 绿色勾选：全部完成
- 🔵 数字：部分完成（显示完成数）
- ⚪ 灰色：未完成
- 🟡 橙色边框：当天

---

### 2. 打卡页面

#### 功能描述
- 显示打卡任务详情
- 输入备注文字
- 上传照片（可选）
- 录制音频（可选）
- 提交打卡

#### 界面元素
```
┌─────────────────────────────────────┐
│  ← 打卡：钢琴练习                   │
│                                     │
│  🎹 钢琴练习                        │
│  • 建议时长：30分钟                 │
│  • 完成奖励：⭐⭐⭐ 30             │
│                                     │
│  📝 备注                            │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │  [输入完成情况...]           │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  📸 添加照片（可选）               │
│  ┌─────┐ ┌─────┐ ┌─────┐         │
│  │ [+] │ │ [+] │ │ [+] │         │
│  └─────┘ └─────┘ └─────┘         │
│                                     │
│  🎤 录音（可选）                   │
│  ┌─────────────────────┐          │
│  │   [🎤 开始录音]      │          │
│  └─────────────────────┘          │
│                                     │
│  ⏱️ 实际用时：35分钟               │
│                                     │
│        [取消]  [提交打卡]          │
└─────────────────────────────────────┘
```

---

### 3. 荣誉墙页面

#### 功能描述
- 显示当前星星⭐️数量
- 展示获得的成就徽章
- 显示连续打卡天数
- 显示累计完成次数

#### 界面元素
```
┌─────────────────────────────────────┐
│  ← 荣誉墙                           │
│                                     │
│  ⭐ 我的星星                        │
│  ┌─────────────────┐               │
│  │     ⭐⭐⭐      │               │
│  │     1,250       │               │
│  │    当前星星      │               │
│  └─────────────────┘               │
│                                     │
│  🏆 我的成就                        │
│  ┌─────┐ ┌─────┐ ┌─────┐         │
│  │ 🌱  │ │ 🔥  │ │ 🎓  │         │
│  │初出茅庐│坚持不懈│学霸之星│        │
│  │2025.01│ │7天   │ │50次  │       │
│  └─────┘ └─────┘ └─────┘         │
│                                     │
│  📊 学习统计                        │
│  • 连续打卡：🔥 7天                 │
│  • 累计完成：128次                  │
│  • 最长连续：14天                   │
│  • 本月完成：42/45                  │
└─────────────────────────────────────┘
```

---

### 4. 愿望清单页面

#### 功能描述
- 显示当前可用星星
- 展示可兑换的愿望和奖品
- 点击兑换愿望
- 显示已兑换的愿望历史

#### 界面元素
```
┌─────────────────────────────────────┐
│  ← 愿望清单          ⭐ 1,250       │
│                                     │
│  🎁 可兑换愿望                      │
│  ┌─────────────────────┐           │
│  │  🎮 30分钟游戏时间   │           │
│  │  消耗：⭐⭐⭐ 300   │           │
│  │              [兑换]  │           │
│  └─────────────────────┘           │
│  ┌─────────────────────┐           │
│  │  🍦 冰淇淋一份       │           │
│  │  消耗：⭐⭐⭐ 300   │           │
│  │              [兑换]  │           │
│  └─────────────────────┘           │
│  ┌─────────────────────┐           │
│  │  🎠 游乐园一次       │           │
│  │  消耗：⭐⭐⭐⭐⭐⭐ 600│ │
│  │              [兑换]  │           │
│  └─────────────────────┘           │
│                                     │
│  📋 已兑换历史                      │
│  ┌─────────────────────────────┐  │
│  │ 2025-01-15  🍦 冰淇淋        │  │
│  │ -⭐⭐⭐ 300                │  │
│  └─────────────────────────────┘  │
└─────────────────────────────────────┘
```

---

### 5. 星星历史页面

#### 功能描述
- 查看星星获得历史
- 查看星星消费历史
- 按日期筛选查看
- 显示累计获得和消费

#### 界面元素
```
┌─────────────────────────────────────┐
│  ← 星星历史                         │
│                                     │
│  累计获得：⭐⭐ 1,500               │
│  累计消费：⭐ 250                   │
│  当前星星：⭐⭐⭐ 1,250             │
│                                     │
│  📜 历史记录                        │
│  ┌─────────────────────────────┐  │
│  │ 2025-01-19  +⭐⭐ 30        │  │
│  │ 钢琴练习 (审核通过)          │  │
│  │ 19:30                       │  │
│  └─────────────────────────────┘  │
│  ┌─────────────────────────────┐  │
│  │ 2025-01-19  +⭐⭐ 20        │  │
│  │ 家庭作业 (审核通过)          │  │
│  │ 20:15                       │  │
│  └─────────────────────────────┘  │
│  ┌─────────────────────────────┐  │
│  │ 2025-01-18  -⭐⭐⭐ 300     │  │
│  │ 兑换愿望：🍦冰淇淋          │  │
│  │ 15:00                       │  │
│  └─────────────────────────────┘  │
│                                     │
│  [📅 筛选] [📊 统计]             │
└─────────────────────────────────────┘
```

---

### 6. 月度报告页面

#### 功能描述
- 选择查看月份
- 柱状图：每日完成数量
- 饼图：任务完成分布
- 折线图：本周趋势
- 可导出PDF
- 可打印

#### 界面元素
```
┌─────────────────────────────────────┐
│  ← 月度报告                         │
│                                     │
│  选择月份：[2025年1月 ▼]           │
│                                     │
│  📊 本月概览                       │
│  • 完成天数：18/20天                │
│  • 完成任务：108/120项              │
│  • 完成率：90%                      │
│  • 获得星星：⭐⭐⭐ 360            │
│                                     │
│  📈 每日完成趋势（柱状图）          │
│  ┌─────────────────────────────┐  │
│  │    █                         │  │
│  │    █                         │  │
│  │    █ █                       │  │
│  │    █ █ █ █                   │  │
│  │    █ █ █ █ █ █               │  │
│  │ 1 3 5 7 9 11 13 15 17 19     │  │
│  └─────────────────────────────┘  │
│                                     │
│  🥧 任务分布（饼图）               │
│  ┌─────────────────────────────┐  │
│  │    钢琴 30%                  │  │
│  │    阅读 25%                  │  │
│  │    作业 20%                  │  │
│  │    其他 25%                  │  │
│  └─────────────────────────────┘  │
│                                     │
│  [📄 导出PDF] [🖨️ 打印]          │
└─────────────────────────────────────┘
```

---

### 7. 学习计划页面（管理员）

#### 功能描述
- 显示当前的学习计划列表
- 显示每个计划的打卡频率
- 显示计划的执行状态
- 添加/编辑/删除计划

#### 界面元素
```
┌─────────────────────────────────────┐
│  ← 学习计划         [+ 添加计划]    │
│                                     │
│  当前计划列表                       │
│  ┌─────────────────────────────┐  │
│  │ 🎹 钢琴练习        [编辑][删除]│  │
│  │ • 频率：每天               │  │
│  │ • 时长：30分钟             │  │
│  │ • 奖励：⭐⭐⭐ 30        │  │
│  │ • 要求：📸照片 🎤音频      │  │
│  │ • 状态：进行中             │  │
│  └─────────────────────────────┘  │
│  ┌─────────────────────────────┐  │
│  │ 📝 家庭作业       [编辑][删除]│  │
│  │ • 频率：周一至周五         │  │
│  │ • 时长：30分钟             │  │
│  │ • 奖励：⭐⭐⭐ 20        │  │
│  │ • 要求：无                │  │
│  │ • 状态：进行中             │  │
│  └─────────────────────────────┘  │
└─────────────────────────────────────┘
```

#### 添加计划弹窗
```
┌─────────────────────────────────────┐
│  添加学习计划                       │
│                                     │
│  计划名称：[_______________]        │
│  选择图标：🎹 📝 ✍️ 🔢 📚 🎤     │
│                                     │
│  打卡频率：                         │
│  ○ 每天                            │
│  ○ 周一至周五                      │
│  ○ 自定义                          │
│    ☑周一 ☑周二 ☑周三 ☑周四 ☑周五  │
│    ☐周六 ☐周日                     │
│                                     │
│  建议时长：[___] 分钟               │
│  奖励星星：[___] ⭐                 │
│                                     │
│  打卡要求：                         │
│  ☐ 需要上传照片                     │
│  ☐ 需要录制音频                     │
│                                     │
│  [取消]  [保存]                     │
└─────────────────────────────────────┘
```

---

### 8. 管理员后台

#### 8.1 管理员登录
```
┌─────────────────────────────────────┐
│          管理员登录                 │
│                                     │
│  用户名：[_______________]          │
│  密码：  [_______________]          │
│                                     │
│        [登录]                       │
│                                     │
│        [忘记密码?]                  │
└─────────────────────────────────────┘
```

#### 8.2 后台首页
```
┌─────────────────────────────────────┐
│  管理员后台                         │
│                                     │
│  📊 数据概览                       │
│  ┌──────┐ ┌──────┐ ┌──────┐       │
│  │ 3    │ │ 5    │ │ 42   │       │
│  │孩子数│ │待审核│ │今日完成│       │
│  └──────┘ └──────┘ └──────┘       │
│                                     │
│  快捷操作：                         │
│  [📝 添加计划] [🎁 添加愿望]       │
│  [👧 添加孩子] [📊 查看报告]       │
│                                     │
│  最近活动：                         │
│  • 小虾米完成了钢琴练习 (19:30)    │
│  • 小明提交了家庭作业 (20:15)      │
│  • 小花兑换了冰淇淋 (昨天)         │
│                                     │
│  菜单：                             │
│  • 👦👧 孩子管理                   │
│  • 📝 计划管理                     │
│  • 📋 打卡审核 (5)                 │
│  • 🎁 愿望管理                     │
│  • 📊 统计报告                     │
│  • ⚙️  系统设置                   │
└─────────────────────────────────────┘
```

#### 8.3 孩子管理
```
┌─────────────────────────────────────┐
│  ← 孩子管理           [+ 添加孩子]  │
│                                     │
│  孩子列表                           │
│  ┌─────────────────────────────┐  │
│  │ 👧 小虾米        [编辑][删除]│  │
│  │ • 主题：👸 公主主题         │  │
│  │ • 等级：LV3                 │  │
│  │ • 星星：⭐⭐⭐ 1,250       │  │
│  │ • 状态：正常                │  │
│  │ • 最近打卡：今天 19:30      │  │
│  └─────────────────────────────┘  │
│  ┌─────────────────────────────┐  │
│  │ 👦 小明          [编辑][删除]│  │
│  │ • 主题：🤴 王子主题         │  │
│  │ • 等级：LV2                 │  │
│  │ • 星星：⭐⭐ 850          │  │
│  │ • 状态：正常                │  │
│  │ • 最近打卡：今天 20:15      │  │
│  └─────────────────────────────┘  │
└─────────────────────────────────────┘
```

#### 8.4 打卡审核
```
┌─────────────────────────────────────┐
│  ← 打卡审核          待审核 (5)     │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 👧 小虾米 - 钢琴练习        │  │
│  │ • 时间：2025-01-19 19:30    │  │
│  │ • 用时：35分钟              │  │
│  │ • 备注：练习了《小星星》    │  │
│  │ • 照片：[查看]              │  │
│  │ • 音频：[播放]              │  │
│  │                             │  │
│  │ [✅ 通过] [❌ 拒绝]         │  │
│  └─────────────────────────────┘  │
│                                     │
│  已审核记录                         │
│  [查看更多]                         │
└─────────────────────────────────────┘
```

---

### 9. 主题设置

#### 9.1 公主主题
```css
配色方案：
- 主色：粉色 #FFB6C1
- 辅助色：紫色 #DDA0DD
- 强调色：金色 #FFD700
- 背景：渐变粉白
- 字体：圆润可爱
- 图标：公主风装饰
```

#### 9.2 王子主题
```css
配色方案：
- 主色：蓝色 #4169E1
- 辅助色：深蓝 #191970
- 强调色：金色 #FFD700
- 背景：渐变蓝白
- 字体：稳重清晰
- 图标：骑士风装饰
```

---

## 🔄 完整数据流程

### 打卡流程（需审核）
```
1. 孩子点击任务打卡
   ↓
2. 进入打卡页面
   ↓
3. 填写备注（可选）
   ↓
4. 上传照片/音频（根据计划要求）
   ↓
5. 提交打卡记录
   ↓
6. 状态：待审核 (pending)
   ↓
7. 管理员收到通知
   ↓
8. 管理员审核
   ├→ 通过：状态变为 approved
   │   → 孩子获得星星⭐
   │   → 更新统计
   │   → 记录星星历史
   │   → 检查成就解锁
   └→ 拒绝：状态变为 rejected
       → 记录拒绝原因
       → 不获得星星
```

### 星星流程
```
获得星星：
完成任务 → 提交审核 → 审核通过 → 获得星星 → 更新余额 → 记录历史

消费星星：
浏览愿望 → 点击兑换 → 确认兑换 → 扣除星星 → 记录兑换 → 记录历史
```

### 数据同步流程
```
本地优先写入：
1. 打卡 → 立即保存到 LocalStorage
   ↓
2. 后台同步到 Supabase
   ↓
3. 同步成功 → 更新本地状态
   ↓
4. 同步失败 → 标记为待同步
   ↓
5. 网络恢复 → 自动重试同步

离线支持：
- 所有操作先写本地
- Service Worker 监听网络
- 网络恢复时自动同步
```

---

## 🎨 UI/UX 设计规范

### 色彩方案

#### 公主主题
```css
主色调：
- 粉色 #FFB6C1（主按钮、强调）
- 紫色 #DDA0DD（卡片、装饰）
- 金色 #FFD700（星星、奖励）
- 白色 #FFFFFF（背景）

辅助色：
- 浅粉 #FFE4E1（背景渐变）
- 玫瑰粉 #FF69B4（链接）
- 薰衣草 #E6E6FA（边框）
```

#### 王子主题
```css
主色调：
- 蓝色 #4169E1（主按钮、强调）
- 深蓝 #191970（卡片、装饰）
- 金色 #FFD700（星星、奖励）
- 白色 #FFFFFF（背景）

辅助色：
- 天蓝 #87CEEB（背景渐变）
- 海蓝 #0066CC（链接）
- 银灰 #C0C0C0（边框）
```

### 字体规范
```css
标题：28-32px，粗体
副标题：20-24px，中等
正文：16-18px，常规
小字：12-14px，常规

公主主题：圆润字体
王子主题：稳重字体
```

### 间距规范
```css
页面边距：20px
卡片间距：15px
元素间距：10px
小间距：5px
```

### 圆角规范
```css
页面卡片：20px
按钮：15px
输入框：10px
小元素：8px
头像：50%
```

---

## 📊 数据存储策略

### LocalStorage 结构
```javascript
// 当前选中的孩子
localStorage.setItem('xcm_current_child', JSON.stringify({
  id: 'uuid',
  name: '小虾米',
  theme: 'princess'
}))

// 孩子列表缓存
localStorage.setItem('xcm_children_list', JSON.stringify([...]))

// 今日打卡状态（快速显示）
localStorage.setItem('xcm_today_checkins', JSON.stringify({
  date: '2025-01-19',
  items: [...]
}))

// 离线待同步数据
localStorage.setItem('xcm_pending_sync', JSON.stringify([
  { type: 'check_in', data: {...}, status: 'pending' }
]))

// 主题设置
localStorage.setItem('xcm_theme', 'princess')

// 离线缓存标记
localStorage.setItem('xcm_offline_mode', 'true')
```

### Supabase 表结构（前缀：xcm_）

所有表名必须加 `xcm_` 前缀，避免多项目混乱。

详见上文"数据库设计"部分。

---

## 🔊 语音提示

### 语音文案
```javascript
// 打卡成功
const voices = {
  checkinSuccess: [
    "太棒了！你完成了这个任务！",
    "真厉害！继续保持哦！",
    "做得好！为你点赞！",
    "优秀！又完成一项任务！"
  ],
  achievementUnlocked: [
    "恭喜你解锁了新成就！",
    "哇！你获得了新徽章！",
    "太厉害了！成就达成！"
  ],
  wishRedeemed: [
    "愿望兑换成功！",
    "好棒！你兑换了一个愿望！"
  ],
  streak: [
    "你已经连续打卡7天了！",
    "坚持不懈！连续打卡14天！"
  ]
}

// 公主主题语音（甜美）
// 王子主题语音（稳重）
```

---

## 📈 月度报告图表

### 图表类型

#### 1. 柱状图（每日完成数）
```javascript
// 使用 Chart.js 或 ECharts
{
  type: 'bar',
  data: {
    labels: ['1日', '2日', '3日', ...],
    datasets: [{
      label: '完成任务数',
      data: [6, 5, 6, 4, 6, ...],
      backgroundColor: themeColor
    }]
  }
}
```

#### 2. 饼图（任务分布）
```javascript
{
  type: 'pie',
  data: {
    labels: ['钢琴', '作业', '写字', '数学', '阅读', '唱歌'],
    datasets: [{
      data: [30, 20, 15, 10, 15, 10],
      backgroundColor: [...]
    }]
  }
}
```

#### 3. 折线图（趋势）
```javascript
{
  type: 'line',
  data: {
    labels: ['第1周', '第2周', '第3周', '第4周'],
    datasets: [{
      label: '完成率',
      data: [85, 90, 88, 92],
      borderColor: themeColor
    }]
  }
}
```

---

## 🚀 开发计划

### 第一阶段：基础架构 ✅
- [x] 项目初始化（Vue 3 + Vite）
- [x] Supabase 数据库设计
- [x] LocalStorage 数据结构
- [x] 路由设置
- [x] 主题系统框架

### 第二阶段：核心功能
- [ ] 孩子选择/登录
- [ ] 主页框架
- [ ] 周历视图
- [ ] 任务列表（参考图片样式）
- [ ] 打卡功能
- [ ] 照片上传
- [ ] 音频录制

### 第三阶段：审核系统
- [ ] 管理员登录
- [ ] 打卡审核页面
- [ ] 审核通过/拒绝逻辑
- [ ] 星星奖励机制
- [ ] 审核通知

### 第四阶段：积分系统
- [ ] 星星计算逻辑
- [ ] 星星历史记录
- [ ] 星星统计页面
- [ ] 荣誉墙页面
- [ ] 成就系统

### 第五阶段：愿望系统
- [ ] 愿望列表展示
- [ ] 兑换功能
- [ ] 兑换历史
- [ ] 星星扣除

### 第六阶段：管理功能
- [ ] 孩子管理（CRUD）
- [ ] 学习计划管理
- [ ] 愿望清单管理
- [ ] 统计数据查看

### 第七阶段：报告系统
- [ ] 月度数据统计
- [ ] 图表生成（柱状图）
- [ ] 图表生成（饼图）
- [ ] 图表生成（折线图）
- [ ] PDF 导出
- [ ] 打印功能

### 第八阶段：离线支持
- [ ] Service Worker 配置
- [ ] 离线数据缓存
- [ ] 网络恢复同步
- [ ] 离线提示

### 第九阶段：语音功能
- [ ] 语音合成集成
- [ ] 语音提示配置
- [ ] 主题语音区分
- [ ] 音效集成

### 第十阶段：主题系统
- [ ] 公主主题完整设计
- [ ] 王子主题完整设计
- [ ] 主题切换功能
- [ ] 主题持久化

### 第十一阶段：优化与部署
- [ ] 性能优化
- [ ] 响应式适配
- [ ] Vercel 部署配置
- [ ] Supabase 集成测试
- [ ] 环境变量配置

### 第十二阶段：测试与上线
- [ ] 功能测试
- [ ] 兼容性测试
- [ ] 性能测试
- [ ] 用户测试
- [ ] 正式上线

---

## 🔐 权限与安全

### 角色定义

#### 孩子（学生）
```javascript
{
  role: "child",
  permissions: [
    "view_own_tasks",
    "check_in",
    "upload_photo",
    "upload_audio",
    "view_own_honors",
    "view_wishes",
    "redeem_wishes",
    "view_own_history",
    "view_own_reports"
  ]
}
```

#### 管理员（家长）
```javascript
{
  role: "admin",
  permissions: [
    "manage_children",
    "manage_plans",
    "manage_wishes",
    "review_checkins",
    "view_all_stats",
    "view_all_reports",
    "export_data",
    "system_settings"
  ]
}
```

### 安全措施
```javascript
// 密码加密
import bcrypt from 'bcryptjs'
const hash = await bcrypt.hash(password, 10)

// PIN码验证
const verifyPIN = (input, stored) => {
  return input === stored
}

// 会话管理
const session = {
  token: 'uuid',
  role: 'child | admin',
  childId: 'uuid',
  expiresAt: timestamp
}
```

---

## 📝 Supabase 配置

### 环境变量
```bash
# .env.local
VITE_SUPABASE_URL=your-supabase-url
VITE_SUPABASE_ANON_KEY=your-anon-key

# Supabase 表名前缀
VITE_TABLE_PREFIX=xcm_
```

### Row Level Security (RLS)
```sql
-- 孩子只能看自己的数据
CREATE POLICY "Children can view own data"
ON xcm_check_ins
FOR SELECT
USING (child_id = auth.uid());

-- 管理员可以看所有数据
CREATE POLICY "Admins can view all data"
ON xcm_check_ins
FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM xcm_admins
    WHERE id = auth.uid()
  )
);
```

---

## 🎯 待确认事项

### 已确认 ✅
1. 审核机制：需要，管理员审核通过后生效
2. 积分单位：使用星星⭐️
3. 愿望分类：不需要分类
4. 多孩子支持：需要，管理员后台添加
5. 照片/音频：不必须，但可选
6. 离线支持：需要
7. 数据导出：需要（CSV/Excel）
8. 月度报告：需要，含图表分析
9. 语音提示：需要
10. 主题切换：需要（公主/王子）
11. 数据库：使用 Supabase
12. 表名前缀：xcm_
13. 任务卡片样式：参考图片 1.jpg

### 已确认规则
1. ✅ 审核时效：**不允许**自动通过，必须由管理员手动审核
2. ✅ 星星数量：由管理员在添加学习计划时手动指定（不按时间计算）
3. ✅ 补打规则：**不允许**补打前几天的卡，只能当天打卡
4. ✅ 成就奖励：暂不考虑特殊奖励
5. ✅ 邮件发送：不需要自动发送月度报告到家长邮箱
6. ✅ 数据备份：不需要定期备份到本地
7. ✅ 多设备同步：每个孩子每天固定在同一设备打卡，不考虑冲突处理

---

## 📞 技术支持

### 常见问题
```markdown
Q: Supabase 免费版够用吗？
A: 免费版提供 500MB 数据库 + 1GB 存储，对于个人使用足够。

Q: Vercel 部署是否收费？
A: 免费版提供每月 100GB 流量，个人项目够用。

Q: 照片/音频存在哪里？
A: 存在 Supabase Storage，免费版 1GB。

Q: 离线数据会丢失吗？
A: 不会，本地有备份，联网后自动同步。
```

---

## 📚 参考资料

### 技术文档
- Vue 3: https://vuejs.org/
- Vite: https://vitejs.dev/
- Supabase: https://supabase.com/docs
- Chart.js: https://www.chartjs.org/
- Service Worker: https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API

### 设计参考
- 图片参考：/Volumes/WORK/程序claude/小虾米每日打卡/pic/
- UI 设计：参考提供的所有图片

---

**文档版本：** v2.0
**最后更新：** 2025-01-19
**文档状态：** 已更新，待最终确认
**下次更新：** 确认待讨论事项后
